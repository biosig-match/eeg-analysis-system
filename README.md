-----

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è„³æ³¢è§£æã‚·ã‚¹ãƒ†ãƒ  (ESP32 + Flutter + Python Server)

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€è‡ªä½œã®8ãƒãƒ£ãƒ³ãƒãƒ«è„³æ³¢è¨ˆï¼ˆESP32-S3ï¼‰ã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚¢ãƒ—ãƒªã‚’ä»‹ã—ã¦Windowsã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ã€**MNE-Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«è§£æãƒ»å¯è¦–åŒ–ã™ã‚‹ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

-----

## âœ¨ ä¸»ãªæ©Ÿèƒ½

  - **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢**: Seeed Studio XIAO ESP32S3 ã‚’ç”¨ã„ãŸ8ãƒãƒ£ãƒ³ãƒãƒ«è„³æ³¢ãƒ‡ãƒ¼ã‚¿å–å¾—
  - **ãƒ‡ãƒ¼ã‚¿åœ§ç¸®**: **zstandardãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ã«ã‚ˆã‚‹é«˜åŠ¹ç‡ãªãƒ‡ãƒ¼ã‚¿åœ§ç¸®ãƒ»è»¢é€
  - **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡**: **BLE**ã«ã‚ˆã‚‹å®‰å®šã—ãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼ˆACKãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ä»˜ãï¼‰
  - **ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒª (Flutter)**:
      - ç”Ÿæ³¢å½¢ï¼ˆ8chï¼‰ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤º
      - ã‚µãƒ¼ãƒãƒ¼ã§è§£æã•ã‚ŒãŸçµæœï¼ˆç”»åƒãƒ»æ•°å€¤ï¼‰ã®è¡¨ç¤º
  - **ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰è§£æ (Python)**:
      - **SQLite**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
      - å‘¨æ³¢æ•°ã‚¹ãƒšã‚¯ãƒˆãƒ«è§£æ (**PSD**): å„ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ‘ãƒ¯ãƒ¼ã‚¹ãƒšã‚¯ãƒˆãƒ«ã‚’è‰²åˆ†ã‘è¡¨ç¤º
      - åŒæœŸåº¦è§£æ (**Coherence**): é›»æ¥µé–“ã®çµåˆåº¦ã‚’å††ã‚°ãƒ©ãƒ•ã§å¯è¦–åŒ–

-----

## ğŸš€ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ã€å½¹å‰²ã‚’æ˜ç¢ºã«åˆ†é›¢ã—ãŸ3ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚

  * **Firmware (ESP32)**: ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ä¸ã€åœ§ç¸®ã«å°‚å¿µã—ã¾ã™ã€‚
  * **Mobile App (Flutter)**: ESP32ã¨ã‚µãƒ¼ãƒãƒ¼ã‚’ä¸­ç¶™ã—ã€ç”Ÿæ³¢å½¢ã¨è§£æçµæœã®ä¸¡æ–¹ã‚’è¡¨ç¤ºã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã™ã€‚
  * **Server (Python)**: ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ã¦DBã«ä¿å­˜ã—ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§MNEã«ã‚ˆã‚‹é‡ã„è§£æå‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

-----

## ğŸ”§ é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸå¾Œã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä»¥ä¸‹ã®æ‰‹é †ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚

### 1\. Server (Python / Windows)

è§£æã®å¿ƒè‡“éƒ¨ã¨ãªã‚‹Pythonã‚µãƒ¼ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

```bash
# /server ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd server

# ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ
python -m venv venv

# ä»®æƒ³ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–
.\venv\Scripts\activate

# å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã™ã¹ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
python server.py
```

> **æ³¨æ„:** èµ·å‹•æ™‚ã«è­¦å‘ŠãŒå‡ºã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ãŒã€å‹•ä½œã«ã¯å½±éŸ¿ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚µãƒ¼ãƒãƒ¼ãŒ `http://0.0.0.0:5000` ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å¾…ã¡å—ã‘ã¾ã™ã€‚

-----

### 2\. Firmware (ESP32)

**PlatformIO**ã‚’ä½¿ç”¨ã—ãŸESP32ã®ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã§ã™ã€‚

1.  **VSCodeã§é–‹ã**: ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ãã¾ã™ã€‚
2.  **ãƒ“ãƒ«ãƒ‰ & ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: PlatformIOæ‹¡å¼µæ©Ÿèƒ½ãŒè‡ªå‹•çš„ã« `/firmware` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦èªè­˜ã—ã¾ã™ã€‚
      - ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼ˆâœ”ï¼‰ã‚¢ã‚¤ã‚³ãƒ³ã§ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚
      - çŸ¢å°ï¼ˆâ†’ï¼‰ã‚¢ã‚¤ã‚³ãƒ³ã§ESP32ã«ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã‚’æ›¸ãè¾¼ã¿ã¾ã™ã€‚

-----

### 3\. Mobile App (Flutter)

ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºã¨ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒ‡ãƒ¼ã‚¿ä¸­ç¶™ã‚’è¡Œã†ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªã§ã™ã€‚

1.  **ã‚µãƒ¼ãƒãƒ¼IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨­å®š**:
    `mobile_app/lib/analysis_provider.dart` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€`serverIp` å®šæ•°ã®å€¤ã‚’ã€ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ã„ã‚‹PCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚

    ```dart
    // ä¾‹:
    const String serverIp = "192.168.1.10";
    ```

2.  **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**:

    ```bash
    # /mobile_app ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
    cd mobile_app

    # ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å–å¾—
    flutter pub get
    ```

3.  **ã‚¢ãƒ—ãƒªã®å®Ÿè¡Œ**:
    Androidã®å®Ÿæ©Ÿã‚’PCã«æ¥ç¶šã—ã€ä»¥ä¸‹ã®è¨­å®šã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚

      - **USBãƒ‡ãƒãƒƒã‚°ã‚’æœ‰åŠ¹åŒ–**:
        1.  ã€Œè¨­å®šã€\>ã€Œãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã€\>ã€Œãƒ“ãƒ«ãƒ‰ç•ªå·ã€ã‚’7å›ã‚¿ãƒƒãƒ—ã—ã¦é–‹ç™ºè€…å‘ã‘ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã€‚
        2.  ã€Œè¨­å®šã€\>ã€Œã‚·ã‚¹ãƒ†ãƒ ã€\>ã€Œé–‹ç™ºè€…å‘ã‘ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ã‹ã‚‰ã€ŒUSBãƒ‡ãƒãƒƒã‚°ã€ã‚’ä¸€åº¦ã‚ªãƒ•ã«ã—ã€å†åº¦ã‚ªãƒ³ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚
      - **USBæ¥ç¶šãƒ¢ãƒ¼ãƒ‰ã®ç¢ºèª**:
        USBæ¥ç¶šãƒ¢ãƒ¼ãƒ‰ãŒ **ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ / Android Auto** ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

    æº–å‚™ãŒå®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™ã€‚

    ```bash
    flutter run
    ```

-----

## âš™ï¸ `.gitignore` ã®è¨­å®š

ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ä¿ã¤ãŸã‚ã€å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ä»¥ä¸‹ã®å†…å®¹ã§ `.gitignore` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

#### `/firmware/.gitignore`

```gitignore
.pio/
.vscode/
```

#### `/mobile_app/.gitignore`

> **æ³¨æ„**: FlutterãŒè‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® `.gitignore` ã‚’ãã®ã¾ã¾ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

#### `/server/.gitignore`

```gitignore
venv/
__pycache__/
*.pyc
eeg_data.db
```
